<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hacer Pedido | Para√≠so del Libro</title>

<style>

/* ====== ESTILO GENERAL ====== */

body{
  font-family: Arial, sans-serif;
  margin:0;
  background:#f4f6f9;
}

header{
  background:#2c3e50;
  color:white;
  padding:15px;
  text-align:center;
}

nav a{
  color:white;
  margin:0 10px;
  text-decoration:none;
  font-weight:bold;
}

nav a:hover{
  text-decoration:underline;
}

.contenido{
  max-width:1100px;
  margin:auto;
  padding:20px;
  background:white;
}

/* ====== FORMULARIO ====== */

form label{
  font-weight:bold;
}

form input,
form select,
form textarea{
  width:100%;
  padding:10px;
  margin-top:5px;
  margin-bottom:15px;
  border:1px solid #ccc;
  border-radius:6px;
  font-size:14px;
  box-sizing:border-box;
}

/* ====== TABLA RESPONSIVE ====== */

.tabla-responsive{
  width:100%;
  overflow-x:auto;
}

.tabla-pedidos{
  width:100%;
  border-collapse:collapse;
  min-width:800px;
}

.tabla-pedidos th,
.tabla-pedidos td{
  border:1px solid #ddd;
  padding:8px;
  text-align:center;
}

.tabla-pedidos th{
  background:#34495e;
  color:white;
}

/* ====== BOT√ìN ====== */

input[type="submit"]{
  background:#27ae60;
  color:white;
  border:none;
  padding:12px;
  font-size:16px;
  border-radius:6px;
  cursor:pointer;
  width:100%;
}

input[type="submit"]:hover{
  background:#219150;
}

/* ====== TOTAL ====== */

#total{
  font-size:18px;
}

/* ====== RESPONSIVE ====== */

@media(max-width:768px){
  .tabla-pedidos{
    min-width:700px;
  }
}

footer{
  text-align:center;
  padding:15px;
  background:#2c3e50;
  color:white;
  margin-top:20px;
}

</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>

</head>

<body>

<header>
  <h1>üìö Para√≠so del Libro</h1>
  <nav>
    <a href="index.html">Cat√°logo</a>
    <a href="pedido.html">Hacer Pedido</a>
    <a href="politicas.html">Pol√≠ticas</a>
  </nav>
</header>

<section class="contenido">

<h2>Formulario de Pedido</h2>

<form id="formulario">

<label>Nombre Completo</label>
<input type="text" id="nombre" required>

<label>Tel√©fono</label>
<input type="tel" id="telefono" pattern="[0-9]{8}" required>

<label>Correo Electr√≥nico</label>
<input type="email" id="email" required>

<label>Provincia</label>
<select id="provincia" required onchange="actualizarEnvio()">
  <option value="">Selecciona</option>
  <option value="San Jose">San Jos√©</option>
  <option value="Alajuela">Alajuela</option>
  <option value="Cartago">Cartago</option>
  <option value="Heredia">Heredia</option>
  <option value="Guanacaste">Guanacaste</option>
  <option value="Puntarenas">Puntarenas</option>
  <option value="Limon">Lim√≥n</option>
</select>

<label>Direcci√≥n</label>
<textarea id="direccion" required></textarea>

<hr>

<h3>Selecciona hasta 5 libros</h3>

<div class="tabla-responsive">
<table class="tabla-pedidos">

<tr>
<th>Categor√≠a</th>
<th>Libro</th>
<th>Formato</th>
<th>Precio</th>
</tr>

<script>
for(let i=1;i<=5;i++){
document.write(`
<tr>
<td>
<select id="categoria${i}" onchange="cargarLibros(${i})">
<option value="">Selecciona</option>
<option value="Literatura">Literatura</option>
<option value="Educativos">Educativos</option>
<option value="AutoAprendizaje">Auto-Aprendizaje</option>
<option value="SuperacionPersonal">Superaci√≥n</option>
<option value="EstiloVida">Estilo de Vida</option>
<option value="Novedad">Novedades</option>
<option value="Oferta">Ofertas</option>
</select>
</td>

<td>
<select id="tituloLibro${i}" onchange="validarSeleccion(${i})">
<option value="">Seleccione</option>
</select>
</td>

<td><input type="text" id="formato${i}" disabled></td>
<td><input type="text" id="precio${i}" disabled></td>
</tr>
`);
}
</script>

</table>
</div>

<hr>

<p id="subtotal">Subtotal: ¬¢0.00</p>
<p id="costoEnvio">Env√≠o: ¬¢0.00</p>
<p id="total"><strong>Total: ¬¢0.00</strong></p>

<br>

<label>M√©todo de Pago</label>
<select id="metodo_pago" required>
<option value="">Selecciona</option>
<option value="Sinpe">Sinpe M√≥vil</option>
<option value="Transferencia">Transferencia Bancaria</option>
<option value="Efectivo">Efectivo</option>
</select>

<br><br>

<label>
<input type="radio" name="retiro" value="si" required onchange="calcularTotal()">
Retiro f√≠sico
</label>

<label>
<input type="radio" name="retiro" value="no" onchange="calcularTotal()">
Env√≠o
</label>

<br><br>

<label>
<input type="checkbox" required>
Acepto t√©rminos y condiciones
</label>

<br><br>

<input type="submit" value="Realizar Pedido">

</form>

</section>

<footer>
¬© 2026 Para√≠so del Libro
</footer>

<script>

let librosGlobal = [];

async function cargarLibrosJSON(){
  const res = await fetch("libros.json");
  librosGlobal = await res.json();
}

function cargarLibros(index){

  const categoria = document.getElementById("categoria"+index).value;
  const dropdown = document.getElementById("tituloLibro"+index);

  dropdown.innerHTML = "<option value=''>Seleccione</option>";

  librosGlobal
    .filter(l => l.categoria === categoria && l.estatus==="Disponible")
    .forEach(libro=>{
      const option = document.createElement("option");
      option.value = libro.tituloLibro;
      option.textContent = libro.tituloLibro + " - " + libro.autorLibro;
      dropdown.appendChild(option);
    });
}

function validarSeleccion(index){

  const titulo = document.getElementById("tituloLibro"+index).value;

  for(let i=1;i<=5;i++){
    if(i!==index){
      if(document.getElementById("tituloLibro"+i).value === titulo){
        alert("Este libro ya fue seleccionado.");
        document.getElementById("tituloLibro"+index).value="";
        return;
      }
    }
  }

  const libro = librosGlobal.find(l=>l.tituloLibro===titulo);
  if(!libro) return;

  document.getElementById("formato"+index).value = libro.formato;
  document.getElementById("precio"+index).value = libro.precio;

  calcularTotal();
}

function calcularTotal(){

  let subtotal=0;

  for(let i=1;i<=5;i++){
    subtotal += parseFloat(document.getElementById("precio"+i).value) || 0;
  }

  let envio = 2500;

  const retiro = document.querySelector('input[name="retiro"]:checked');

  if(retiro && retiro.value==="si"){
    envio = 0;
  }

  const total = subtotal + envio;

  document.getElementById("subtotal").textContent="Subtotal: ¬¢"+subtotal.toFixed(2);
  document.getElementById("costoEnvio").textContent="Env√≠o: ¬¢"+envio.toFixed(2);
  document.getElementById("total").innerHTML="<strong>Total: ¬¢"+total.toFixed(2)+"</strong>";
}

function actualizarEnvio(){
  calcularTotal();
}

document.addEventListener("DOMContentLoaded", cargarLibrosJSON);

</script>

</body>
</html>
